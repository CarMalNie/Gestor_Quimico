{% extends "base.html" %}
{% load static %} 

{% block title %}Detalle de Compuesto: {{ compuesto.formula_compuesto }}{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        
        <h1 class="mb-3"> Detalle del Compuesto: {{ compuesto.nombre_compuesto }}</h1>
        <hr>

        <div class="card mb-4 shadow">
            <div class="card-body">
                <div class="row align-items-center">
                    
                    <div class="col-md-5 text-center border-end">
                        <p class="display-3 fw-bold text-success mb-1">{{ compuesto.formula_compuesto }}</p>
                        <p class="lead">F贸rmula Qu铆mica</p>
                        <hr class="my-3">
                        <p class="h4">
                            <strong>Peso Molecular (PM):</strong> 
                            <span class="badge bg-dark fs-5">{{ compuesto.peso_molecular_compuesto|floatformat:4 }} g/mol</span>
                        </p>
                    </div>

                    <div class="col-md-7">
                        <h4 class="mb-3">Datos Generales</h4>
                        <ul class="list-unstyled">
                            
                            <li><strong>Nombre (Etiqueta IUPAC):</strong> {{ compuesto.nombre_compuesto }}</li>
                            <hr class="my-2">
                            <li><strong>Fecha de Registro:</strong> {{ compuesto.fecha_registro_compuesto|date:"d M, Y H:i" }}</li>
                            
                        </ul>
                    </div>
                </div>
            </div>
            
            <div class="card-footer bg-light">
                <p class="mb-0 small text-muted">
                    <strong>Usuario Creador:</strong> {{ compuesto.usuario.username|default:"Sistema/Migraci贸n" }}
                </p>
            </div>
        </div>
        
        <div class="text-end mb-4">
            <a href="{% url 'compuesto_actualizar' pk=compuesto.pk %}" class="btn btn-warning me-2">
                Modificar
            </a>
            <a href="{% url 'compuesto_eliminar' pk=compuesto.pk %}" class="btn btn-danger">
                Eliminar
            </a>
        </div>


        <h3 class="mt-5 mb-3">An谩lisis Detallado</h3>
        <ul class="nav nav-tabs" id="compuestoTabs" role="tablist">
        <li class="nav-item" role="presentation">
                <button class="nav-link active" id="composition-tab" data-bs-toggle="tab" data-bs-target="#composition" type="button" role="tab">
                    Composici贸n At贸mica
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="applications-tab" data-bs-toggle="tab" data-bs-target="#applications" type="button" role="tab">
                    Usos y Aplicaciones
                </button>
            </li>
        </ul>
        
        <div class="tab-content border border-top-0 p-3 bg-white" id="compuestoTabsContent">
            
            <div class="tab-pane fade show active" id="composition" role="tabpanel">
                {% if compuesto.elementocompuesto_set.all %}
                <p class="lead text-muted small">Descomposici贸n de la f贸rmula seg煤n sus elementos:</p>
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead class="table-dark">
                            <tr>
                                <th style="width: 25%;">Elemento Qu铆mico</th>
                                <th style="width: 15%;">S铆mbolo</th>
                                <th class="text-center" style="width: 25%;">Cantidad en F贸rmula</th>
                                <th style="width: 35%;">Peso At贸mico (g/mol)</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for elem_comp in compuesto.elementocompuesto_set.all %}
                            <tr>
                                <td>
                                    <a href="{% url 'elemento_detalle' pk=elem_comp.id_elemento.pk %}">
                                        {{ elem_comp.id_elemento.nombre_elemento }}
                                    </a>
                                </td>
                                <td>
                                    <span class="badge bg-secondary fs-6"><strong>{{ elem_comp.id_elemento.simbolo_elemento }}</strong></span>
                                </td>
                                <td class="text-center">
                                    <span class="badge bg-info rounded-pill p-2">{{ elem_comp.cantidad_elem_en_comp }}</span>
                                </td>
                                <td>{{ elem_comp.id_elemento.peso_atomico_elemento|floatformat:4 }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <p class="alert alert-warning">No se encontr贸 la composici贸n at贸mica para este compuesto. El compuesto no pudo descomponerse o no existen los elementos base.</p>
                {% endif %}
            </div>
            
            <div class="tab-pane fade" id="applications" role="tabpanel">
                {% with aplicaciones=compuesto.compuestoaplicacion_set.all %}
                {% if aplicaciones %}
                <p class="lead text-muted small">Detalles sobre la aplicaci贸n industrial y concentraci贸n m铆nima requerida:</p>
                <ul class="list-group">
                    {% for comp_aplic in aplicaciones %}
                        <li class="list-group-item list-group-item-action">
                            
                            <h5 class="mb-1">
                                Uso: <span class="badge bg-info fs-6"><strong>{{ comp_aplic.id_aplicacion.nombre_uso }}</strong></span>
                            </h5>
                            
                            <p class="mb-1 small">
                                Industria: 
                                <span class="badge bg-primary">{{ comp_aplic.id_aplicacion.id_industria.nombre_industria }}</span>
                            </p>
                            
                            <div class="mt-2">
                                <strong>Concentraci贸n Uso Industrial:</strong>
                                <span class="badge bg-success fs-6">
                                    {{ comp_aplic.concentracion_minima|floatformat:2 }} 
                                    ({{ comp_aplic.get_tipo_concentracion_display }})
                                </span>
                            </div>
                        </li>
                    {% endfor %}
                </ul>
                {% else %}
                <p class="alert alert-info">Este compuesto no tiene aplicaciones industriales registradas.</p>
                {% endif %}
                {% endwith %}
            </div>
            
        </div>
        
        <a href="{% url 'compuesto_lista' %}" class="btn btn-secondary mt-4">Volver al Listado</a>
        
    </div>
</div>
{% endblock %}